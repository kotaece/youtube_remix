<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remix Player - Blend Modes</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            overflow: hidden;
            font-family: 'Courier New', sans-serif;
        }

        #remix-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none; 
            user-select: none;
            z-index: 1;
        }

        .video-layer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100vw;
            height: 56.25vw; 
            min-height: 100vh;
            min-width: 177.78vh; 
            opacity: 0;
            transition: opacity 1s ease-in-out; 
            mix-blend-mode: screen; /* 初期値 */
        }

        .video-layer iframe {
            width: 100%;
            height: 100%;
            transform: scale(1.5); 
        }

        /* --- コントロールパネル --- */
        #control-panel {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Blend Mode ボタン */
        #blend-btn {
            background: rgba(0, 0, 0, 0.5);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.5);
            padding: 12px 30px;
            font-size: 16px;
            font-family: inherit;
            font-weight: bold;
            cursor: pointer;
            letter-spacing: 2px;
            border-radius: 50px;
            backdrop-filter: blur(4px);
            transition: all 0.2s;
            text-transform: uppercase;
            min-width: 240px; /* 文字が変わっても幅を固定気味にする */
            text-align: center;
        }

        #blend-btn:hover {
            background: #fff;
            color: #000;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
        }

        #blend-btn:active {
            transform: scale(0.95);
        }

    </style>
</head>
<body>

    <div id="remix-container">
        <div id="player1" class="video-layer"></div>
        <div id="player2" class="video-layer"></div>
        <div id="player3" class="video-layer"></div>
        <div id="player4" class="video-layer"></div>
        <div id="player5" class="video-layer"></div>
    </div>

    <div id="control-panel">
        <button id="blend-btn" onclick="toggleBlendMode()">BLEND: SCREEN</button>
    </div>

    <script>
        const videoIds = ['eyDWLwDRCqc','aI04_iIGYzs', 'U1tZNUgUZlo', 'tOqDliP-47A', '6kEA8FMht2o'];
        let players = [];
        let playerStates = [false, false, false, false, false];

        // ブレンドモードの設定リスト
        const blendModes = ['screen', 'overlay', 'difference', 'exclusion', 'normal'];
        let currentModeIndex = 0;

        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        function onYouTubeIframeAPIReady() {
            videoIds.forEach((id, index) => {
                const playerId = 'player' + (index + 1);
                players[index] = new YT.Player(playerId, {
                    videoId: id,
                    playerVars: {
                        'autoplay': 1, 'controls': 0, 'showinfo': 0, 'modestbranding': 1,
                        'mute': 1, 'loop': 1, 'playlist': id, 'playsinline': 1,
                        'rel': 0, 'disablekb': 1, 'iv_load_policy': 3
                    },
                    events: {
                        'onReady': onPlayerReady,
                        'onStateChange': (event) => onPlayerStateChange(event, index)
                    }
                });
            });
        }

        function onPlayerReady(event) {
            event.target.mute();
            event.target.playVideo();
        }

        function onPlayerStateChange(event, index) {
            if (event.data === YT.PlayerState.PLAYING) {
                setTimeout(() => { playerStates[index] = true; }, 1000);
            }
        }

        // --- ブレンドモード切替機能 ---

        function toggleBlendMode() {
            // 次のモードへインデックスを進める
            currentModeIndex = (currentModeIndex + 1) % blendModes.length;
            const newMode = blendModes[currentModeIndex];

            // 全ての動画レイヤーに新しいモードを適用
            const layers = document.querySelectorAll('.video-layer');
            layers.forEach(layer => {
                layer.style.mixBlendMode = newMode;
            });

            // ボタンの文字を更新
            const btn = document.getElementById('blend-btn');
            btn.innerText = "BLEND: " + newMode;
        }

        // --- オートミックス機能（常に動作） ---

        function autoMixLogic() {
            const layers = document.querySelectorAll('.video-layer');
            layers.forEach((layer, index) => {
                if(playerStates[index]) {
                    // 点滅ロジック
                    const isFlash = Math.random() > 0.4; // 60%の確率で表示
                    if (isFlash) {
                        // 少しランダムな不透明度
                        layer.style.opacity = (Math.random() * 0.6) + 0.2; 
                    } else {
                        layer.style.opacity = 0;
                    }
                }
            });
        }

        function randomJumpLogic() {
            players.forEach((player, index) => {
                // 再生中ならジャンプを試みる
                if (player && player.seekTo && playerStates[index]) {
                    if (Math.random() < 0.3) { 
                        const duration = player.getDuration();
                        if (duration > 0) {
                            player.seekTo(Math.random() * duration, true);
                        }
                    }
                }
            });
        }

        // ループ開始
        setTimeout(() => {
            // 0.5秒ごとに透明度を変更
            setInterval(autoMixLogic, 1000);
            
            // 3秒ごとにジャンプチャンス
            setInterval(randomJumpLogic, 5000);
        }, 3000);

    </script>
</body>
</html>