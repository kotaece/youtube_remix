<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remix Player - 5 Layers</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            overflow: hidden;
            font-family: sans-serif;
        }

        /* 映像コンテナ（操作不可） */
        #remix-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none; 
            user-select: none;
            z-index: 1;
        }

        .video-layer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100vw;
            height: 56.25vw; 
            min-height: 100vh;
            min-width: 177.78vh; 
            opacity: 0;
            /* マニュアル操作の追従性を良くするため、少し短めのtransitionにする */
            transition: opacity 0.2s linear; 
            mix-blend-mode: difference; 
        }

        .video-layer iframe {
            width: 100%;
            height: 100%;
            transform: scale(1.5); 
        }

        /* --- コントロールパネル --- */
        #control-panel {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100; /* 映像より手前に */
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            background: rgba(0, 0, 0, 0.6);
            padding: 15px 30px;
            border-radius: 30px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            /* スマホなどでスライダーがはみ出ないように最大幅を設定 */
            max-width: 90vw; 
        }

        /* モード切替ボタン */
        #mode-btn {
            background: transparent;
            color: #fff;
            border: 2px solid #fff;
            padding: 8px 24px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            letter-spacing: 2px;
            border-radius: 20px;
            transition: all 0.3s;
        }
        #mode-btn:hover {
            background: #fff;
            color: #000;
        }
        #mode-btn.active {
            background: #00ff9d; /* Autoモード時の色 */
            border-color: #00ff9d;
            color: #000;
            box-shadow: 0 0 15px #00ff9d;
        }

        /* スライダーエリア */
        #sliders-container {
            display: flex; /* 横並び */
            gap: 15px;
            opacity: 0.3; /* Autoモード時は薄くする */
            pointer-events: none; /* Autoモード時は触れない */
            transition: opacity 0.3s;
            /* 画面が狭い時に折り返す設定（5本だと横に長くなるため） */
            flex-wrap: wrap; 
            justify-content: center;
        }
        /* Manualモード時のスタイル */
        #sliders-container.manual-active {
            opacity: 1;
            pointer-events: auto;
        }

        /* スライダーの見た目 */
        .fader-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 60px; /* タップしやすい幅を確保 */
        }
        .fader-group label {
            color: #fff;
            font-size: 10px;
            margin-bottom: 5px;
        }
        input[type=range] {
            -webkit-appearance: none; /* デフォルトの見た目を消す */
            width: 80px; /* 5本入るように少し幅を狭めました */
            height: 4px;
            background: #444;
            border-radius: 2px;
            outline: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }

    </style>
</head>
<body>

    <div id="remix-container">
        <div id="player1" class="video-layer"></div>
        <div id="player2" class="video-layer"></div>
        <div id="player3" class="video-layer"></div>
        <div id="player4" class="video-layer"></div>
        <div id="player5" class="video-layer"></div>
    </div>

    <div id="control-panel">
        <button id="mode-btn" onclick="toggleMode()">MODE: AUTO</button>
        
        <div id="sliders-container">
            <div class="fader-group">
                <label>1</label>
                <input type="range" id="range1" min="0" max="1" step="0.01" value="0" oninput="manualMix(0, this.value)">
            </div>
            <div class="fader-group">
                <label>2</label>
                <input type="range" id="range2" min="0" max="1" step="0.01" value="0" oninput="manualMix(1, this.value)">
            </div>
            <div class="fader-group">
                <label>3</label>
                <input type="range" id="range3" min="0" max="1" step="0.01" value="0" oninput="manualMix(2, this.value)">
            </div>
            <div class="fader-group">
                <label>4</label>
                <input type="range" id="range4" min="0" max="1" step="0.01" value="0" oninput="manualMix(3, this.value)">
            </div>
             <div class="fader-group">
                <label>5</label>
                <input type="range" id="range5" min="0" max="1" step="0.01" value="0" oninput="manualMix(4, this.value)">
            </div>
        </div>
    </div>

    <script>
        // 5つの動画ID
        const videoIds = ['eyDWLwDRCqc','aI04_iIGYzs', 'U1tZNUgUZlo', 'tOqDliP-47A', '6kEA8FMht2o'];
        
        let players = [];
        // 5つの状態管理フラグ
        let playerStates = [false, false, false, false, false];

        // モード管理用
        let isAutoMode = true; 
        let autoMixTimer = null;
        let randomJumpTimer = null;

        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        function onYouTubeIframeAPIReady() {
            videoIds.forEach((id, index) => {
                const playerId = 'player' + (index + 1);
                players[index] = new YT.Player(playerId, {
                    videoId: id,
                    playerVars: {
                        'autoplay': 1, 'controls': 0, 'showinfo': 0, 'modestbranding': 1,
                        'mute': 1, 'loop': 1, 'playlist': id, 'playsinline': 1,
                        'rel': 0, 'disablekb': 1, 'iv_load_policy': 3
                    },
                    events: {
                        'onReady': onPlayerReady,
                        'onStateChange': (event) => onPlayerStateChange(event, index)
                    }
                });
            });
        }

        function onPlayerReady(event) {
            event.target.mute();
            event.target.playVideo();
        }

        function onPlayerStateChange(event, index) {
            if (event.data === YT.PlayerState.PLAYING) {
                setTimeout(() => { playerStates[index] = true; }, 1000);
            }
        }

        // --- モード切替機能 ---

        function toggleMode() {
            isAutoMode = !isAutoMode;
            const btn = document.getElementById('mode-btn');
            const sliderContainer = document.getElementById('sliders-container');

            if (isAutoMode) {
                // Autoモードへ切り替え
                btn.innerText = "MODE: AUTO";
                btn.classList.add("active");
                sliderContainer.classList.remove("manual-active");
                
                // オートミックス再開
                startAutoMix();
            } else {
                // Manualモードへ切り替え
                btn.innerText = "MODE: MANUAL";
                btn.classList.remove("active");
                sliderContainer.classList.add("manual-active");
                
                // オートミックス停止
                stopAutoMix();
                
                // スライダーの位置を現在の透明度に合わせる（同期）
                syncSliders();
            }
        }

        // --- マニュアル操作 ---

        function manualMix(index, value) {
            // Manualモードの時だけ有効
            if (!isAutoMode) {
                const layers = document.querySelectorAll('.video-layer');
                if (layers[index]) {
                    layers[index].style.opacity = value;
                }
            }
        }

        // スライダーの位置を現在の画面の明るさに合わせる関数
        function syncSliders() {
            const layers = document.querySelectorAll('.video-layer');
            layers.forEach((layer, index) => {
                const currentOpacity = window.getComputedStyle(layer).opacity;
                const slider = document.getElementById('range' + (index + 1));
                if (slider) {
                    slider.value = currentOpacity;
                }
            });
        }

        // --- オート機能 ---

        function autoMixLogic() {
            if (!isAutoMode) return; // マニュアル時は何もしない

            const layers = document.querySelectorAll('.video-layer');
            layers.forEach((layer, index) => {
                if(playerStates[index]) {
                    // 少し激しめのランダム（0か、0.4〜1.0）
                    const isFlash = Math.random() > 0.4; // 60%の確率で表示
                    if (isFlash) {
                        layer.style.opacity = (Math.random() * 0.6) + 0.2; 
                    } else {
                        layer.style.opacity = 0;
                    }
                }
            });
        }

        function randomJumpLogic() {
            players.forEach((player, index) => {
                if (player && player.seekTo && playerStates[index]) {
                    if (Math.random() < 0.3) { 
                        const duration = player.getDuration();
                        if (duration > 0) {
                            player.seekTo(Math.random() * duration, true);
                        }
                    }
                }
            });
        }

        function startAutoMix() {
            // 既に動いていたら重複しないようにクリア
            stopAutoMix();
            
            // 0.5秒ごとに透明度変更（ご指定の値）
            autoMixTimer = setInterval(autoMixLogic, 500);
        }

        function stopAutoMix() {
            if (autoMixTimer) clearInterval(autoMixTimer);
        }

        // 初期化処理
        setTimeout(() => {
            // 初期状態はAutoモード
            const btn = document.getElementById('mode-btn');
            btn.classList.add("active");
            
            startAutoMix();
            
            // ジャンプ機能はずっと動かしておく（3秒ごと：ご指定の値）
            randomJumpTimer = setInterval(randomJumpLogic, 3000);
        }, 3000);

    </script>
</body>
</html>