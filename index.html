<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remix Player - Glitch Edition</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            overflow: hidden;
            font-family: 'Courier New', sans-serif;
        }

        /* --- ノイズオーバーレイ（新機能） --- */
        /* 画面全体にザラザラした質感を乗せる透明なレイヤー */
        #noise-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 50; /* 映像より手前、ボタンより奥 */
            opacity: 0.15; /* ノイズの濃さ */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        #remix-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none; 
            user-select: none;
            z-index: 1;
        }

        .video-layer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100vw;
            height: 56.25vw; 
            min-height: 100vh;
            min-width: 177.78vh; 
            opacity: 0;
            mix-blend-mode: screen;
            /* 【変更】グリッチ感を出すため、変化をカクカクさせる */
            transition: all 0.05s steps(2);
            /* フィルターの初期値 */
            filter: none;
        }

        .video-layer iframe {
            width: 100%;
            height: 100%;
            /* 基準スケール */
            transform: scale(1.5);
            transition: transform 0.05s steps(2);
        }

        /* --- グリッチ用CSSクラス（新機能） --- */
        
        /* パターンA: 強烈な色反転と彩度ブースト */
        .glitch-invert {
            filter: invert(1) saturate(3) contrast(2) !important;
        }

        /* パターンB: 歪み（iframeに適用する） */
        /* 親のscale(1.5)にさらに歪みを加える設定 */
        .video-layer.glitch-skew iframe {
            transform: scale(1.6) skewX(20deg) translateX(30px) !important;
        }

        /* パターンC: 瞬間的なブラーと輝度アップ */
        .glitch-blur {
            filter: blur(10px) brightness(2.5) !important;
            opacity: 1 !important; /* 強制的に表示 */
        }

        /* --- コントロールパネル --- */
        #control-panel {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #blend-btn {
            background: rgba(0, 0, 0, 0.5);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.5);
            padding: 12px 30px;
            font-size: 16px;
            font-family: inherit;
            font-weight: bold;
            cursor: pointer;
            letter-spacing: 2px;
            border-radius: 50px;
            backdrop-filter: blur(4px);
            transition: all 0.2s;
            text-transform: uppercase;
            min-width: 240px; 
            text-align: center;
        }

        #blend-btn:hover {
            background: #fff;
            color: #000;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
        }

        #blend-btn:active {
            transform: scale(0.95);
        }

    </style>
</head>
<body>

    <div id="noise-overlay"></div>

    <div id="remix-container">
        <div id="player1" class="video-layer"></div>
        <div id="player2" class="video-layer"></div>
        <div id="player3" class="video-layer"></div>
        <div id="player4" class="video-layer"></div>
        <div id="player5" class="video-layer"></div>
    </div>

    <div id="control-panel">
        <button id="blend-btn" onclick="toggleBlendMode()">BLEND: SCREEN</button>
    </div>

    <script>
        const videoIds = ['eyDWLwDRCqc','aI04_iIGYzs', 'U1tZNUgUZlo', 'tOqDliP-47A', '6kEA8FMht2o'];
        let players = [];
        let playerStates = [false, false, false, false, false];

        const blendModes = ['screen', 'overlay', 'difference', 'exclusion', 'normal'];
        let currentModeIndex = 0;

        // グリッチの種類を定義
        const glitchTypes = ['glitch-invert', 'glitch-skew', 'glitch-blur'];

        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        function onYouTubeIframeAPIReady() {
            videoIds.forEach((id, index) => {
                const playerId = 'player' + (index + 1);
                players[index] = new YT.Player(playerId, {
                    videoId: id,
                    playerVars: {
                        'autoplay': 1, 'controls': 0, 'showinfo': 0, 'modestbranding': 1,
                        'mute': 1, 'loop': 1, 'playlist': id, 'playsinline': 1,
                        'rel': 0, 'disablekb': 1, 'iv_load_policy': 3
                    },
                    events: {
                        'onReady': onPlayerReady,
                        'onStateChange': (event) => onPlayerStateChange(event, index)
                    }
                });
            });
        }

        function onPlayerReady(event) {
            event.target.mute();
            event.target.playVideo();
        }

        function onPlayerStateChange(event, index) {
            if (event.data === YT.PlayerState.PLAYING) {
                setTimeout(() => { playerStates[index] = true; }, 1000);
            }
        }

        function toggleBlendMode() {
            currentModeIndex = (currentModeIndex + 1) % blendModes.length;
            const newMode = blendModes[currentModeIndex];
            const layers = document.querySelectorAll('.video-layer');
            layers.forEach(layer => {
                layer.style.mixBlendMode = newMode;
            });
            const btn = document.getElementById('blend-btn');
            btn.innerText = "BLEND: " + newMode;
        }

        // --- オートミックス機能 ---
        function autoMixLogic() {
            const layers = document.querySelectorAll('.video-layer');
            layers.forEach((layer, index) => {
                if(playerStates[index]) {
                    const isFlash = Math.random() > 0.4; 
                    if (isFlash) {
                        layer.style.opacity = (Math.random() * 0.6) + 0.2; 
                    } else {
                        layer.style.opacity = 0;
                    }
                }
            });
        }

        // --- ジャンプ機能 ---
        function randomJumpLogic() {
            players.forEach((player, index) => {
                if (player && player.seekTo && playerStates[index]) {
                    if (Math.random() < 0.3) { 
                        const duration = player.getDuration();
                        if (duration > 0) {
                            player.seekTo(Math.random() * duration, true);
                        }
                    }
                }
            });
        }

        // --- グリッチトリガー機能（新機能） ---
        function triggerGlitch() {
            // 1. 再生中のレイヤーのインデックスを探す
            const activeIndexes = [];
            playerStates.forEach((state, index) => {
                if (state) activeIndexes.push(index);
            });

            // 再生中のものがなければ何もしない
            if (activeIndexes.length === 0) return;

            // 2. 確率で発動（例: 30%の確率でグリッチ発生）
            if (Math.random() > 0.3) return;

            // 3. ターゲットとグリッチの種類をランダムに決定
            const targetIndex = activeIndexes[Math.floor(Math.random() * activeIndexes.length)];
            const targetLayer = document.getElementById('player' + (targetIndex + 1));
            const glitchType = glitchTypes[Math.floor(Math.random() * glitchTypes.length)];

            // 4. グリッチ用クラスを付与
            targetLayer.classList.add(glitchType);

            // 5. ほんの一瞬後にクラスを削除（50ms〜200msの間）
            const duration = Math.random() * 150 + 50;
            setTimeout(() => {
                targetLayer.classList.remove(glitchType);
            }, duration);
        }


        // ループ開始
        setTimeout(() => {
            // 透明度変更（少し早めに）
            setInterval(autoMixLogic, 400);
            
            // ジャンプ
            setInterval(randomJumpLogic, 3000);

            // グリッチチェック（頻繁にチェックする）
            setInterval(triggerGlitch, 200);

        }, 3000);

    </script>
</body>
</html>