<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>YouTube Overlay Remix</title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #000; color: #fff; margin: 0; padding: 20px; }
        
        /* 映像を重ねるためのコンテナ */
        .screen-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            /* 16:9 の比率を維持するテクニック */
            padding-bottom: 56.25%; 
            height: 0;
            overflow: hidden;
            border: 2px solid #444;
            background: #000;
        }

        /* プレーヤーを強制的に同じ場所に配置 */
        .player-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* 上の動画がクリックを邪魔しないようにする */
        }

        /* 下のレイヤー（ベース） */
        #player1-box {
            z-index: 1;
        }

        /* 上のレイヤー（ブレンド用） */
        #player2-box {
            z-index: 2;
            opacity: 0.5; /* 初期透明度 */
            /* 映像編集ソフトのような合成モード（ブラウザによって動作が異なる場合があります） */
            mix-blend-mode: screen; 
        }

        /* YouTubeのiframe自体のスタイル */
        iframe { width: 100%; height: 100%; }

        .controls { margin-top: 30px; padding: 20px; background: #222; border-radius: 8px; display: inline-block; }
        input[type="text"] { width: 120px; background: #333; color: white; border: 1px solid #555; padding: 5px; }
        button { padding: 10px 20px; background: #ff0033; color: white; border: none; cursor: pointer; font-size: 16px; margin: 5px; }
        button:hover { background: #cc0000; }
        
        /* スライダーのスタイル */
        .slider-container { margin: 15px 0; }
        input[type="range"] { width: 300px; cursor: pointer; }
    </style>
</head>
<body>

    <h1>Overlay Remix Player</h1>

    <div class="screen-container">
        <div id="player1-box" class="player-layer">
            <div id="player1"></div>
        </div>
        <div id="player2-box" class="player-layer">
            <div id="player2"></div>
        </div>
    </div>

    <div class="controls">
        <div class="slider-container">
            <label>動画2の透明度 (MIX): <span id="opacity-val">50%</span></label><br>
            <input type="range" id="opacitySlider" min="0" max="1" step="0.01" value="0.5" oninput="changeOpacity(this.value)">
        </div>

        <div>
            <label>ID 1: <input type="text" id="vid1" value="jfKfPfyJRdk"></label>
            <label>ID 2: <input type="text" id="vid2" value="5qap5aO4i9A"></label>
            <label>間隔: <input type="number" id="interval" value="5" style="width:40px">秒</label>
        </div>
        <br>
        <button onclick="startRemix()">▶ PLAY REMIX</button>
        <button onclick="stopRemix()" style="background:#555;">■ STOP</button>
        <p id="status-text" style="color:#aaa; font-size:12px;">準備完了</p>
    </div>

    <script>
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        var player1, player2;
        var remixTimer = null;

        function onYouTubeIframeAPIReady() {
            var defaultId1 = document.getElementById('vid1').value;
            var defaultId2 = document.getElementById('vid2').value;

            var playerConfig = {
                width: '100%',
                height: '100%',
                playerVars: { 
                    'controls': 0, // 映像だけ見せるためにYouTubeのコントローラーを隠す
                    'showinfo': 0,
                    'rel': 0,
                    'modestbranding': 1,
                    'mute': 1,
                    // 重要：ローカルサーバー以外で動かす場合のエラー対策
                    'origin': window.location.origin 
                }
            };

            // Player 1 (背面)
            player1 = new YT.Player('player1', Object.assign({}, playerConfig, { videoId: defaultId1 }));
            
            // Player 2 (前面)
            player2 = new YT.Player('player2', Object.assign({}, playerConfig, { videoId: defaultId2 }));
        }

        function changeOpacity(val) {
            document.getElementById('player2-box').style.opacity = val;
            document.getElementById('opacity-val').innerText = Math.round(val * 100) + "%";
        }

        function jumpToRandom(player) {
            var duration = player.getDuration();
            if (!duration) return;
            var randomTime = Math.floor(Math.random() * (duration * 0.95));
            player.seekTo(randomTime, true);
        }

        function startRemix() {
            var v1 = document.getElementById('vid1').value;
            var v2 = document.getElementById('vid2').value;
            var intervalSec = document.getElementById('interval').value;

            player1.loadVideoById(v1);
            player2.loadVideoById(v2);
            
            player1.unMute(); 
            // 2つの音が混ざるとうるさい場合があるので、片方を少し下げるなどの調整もJSで可能
            // player2.setVolume(70); 
            player2.unMute();

            document.getElementById('status-text').innerText = "再生中 (MIX MODE)";

            // 初回ジャンプ
            jumpToRandom(player1);
            jumpToRandom(player2);

            if (remixTimer) clearInterval(remixTimer);
            remixTimer = setInterval(function() {
                // 両方同時にジャンプすると読み込み負荷が高いので、ランダムにどちらか、あるいは両方を飛ばす
                if(Math.random() > 0.5) jumpToRandom(player1);
                if(Math.random() > 0.5) jumpToRandom(player2);
            }, intervalSec * 1000);
        }

        function stopRemix() {
            if (remixTimer) clearInterval(remixTimer);
            player1.pauseVideo();
            player2.pauseVideo();
            document.getElementById('status-text').innerText = "停止";
        }
    </script>
</body>
</html>