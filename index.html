<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>YouTube Random Remix Player</title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #222; color: #fff; }
        .container { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-top: 20px; }
        .video-wrapper { width: 45%; max-width: 480px; }
        iframe { width: 100%; height: 270px; border: none; }
        .controls { margin: 20px; padding: 20px; background: #333; border-radius: 8px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; background: #ff0033; color: white; border: none; border-radius: 4px; }
        button:hover { background: #cc0000; }
        button.stop { background: #555; }
        input { padding: 5px; width: 150px; text-align: center; }
        .status { margin-top: 10px; color: #aaa; font-size: 0.9em; }
    </style>
</head>
<body>

    <h1>YouTube Random Remix Player</h1>
    <p>2つの動画を同時に再生し、指定した秒数ごとにランダムなシーンへジャンプします。</p>

    <div class="controls">
        <div>
            <label>動画ID 1: <input type="text" id="vid1" value="jfKfPfyJRdk"></label>
            <label>動画ID 2: <input type="text" id="vid2" value="5qap5aO4i9A"></label>
        </div>
        <br>
        <div>
            <label>ジャンプ間隔: <input type="number" id="interval" value="10" style="width:50px;"> 秒</label>
        </div>
        <br>
        <button onclick="startRemix()">▶ リミックス開始</button>
        <button class="stop" onclick="stopRemix()">■ 停止</button>
        <div class="status" id="status-text">準備完了（開始ボタンを押してください）</div>
    </div>

    <div class="container">
        <div class="video-wrapper">
            <h3>Player 1 (Drums/Base)</h3>
            <div id="player1"></div>
        </div>
        <div class="video-wrapper">
            <h3>Player 2 (Melody/Ambience)</h3>
            <div id="player2"></div>
        </div>
    </div>

    <script>
        // YouTube APIのスクリプトを読み込む
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        var player1, player2;
        var remixTimer = null;

        // APIの準備ができたら呼ばれる関数
        function onYouTubeIframeAPIReady() {
            // 初期動画ID (Lo-fi Hip Hop radioなどのライブ配信や長い動画が適しています)
            // ここではサンプルとして有名な「Lofi Girl」などのIDを入れています
            var defaultId1 = document.getElementById('vid1').value;
            var defaultId2 = document.getElementById('vid2').value;

            player1 = new YT.Player('player1', {
                videoId: defaultId1,
                playerVars: { 'controls': 1, 'mute': 1 } // 最初はミュート（自動再生対策）
            });

            player2 = new YT.Player('player2', {
                videoId: defaultId2,
                playerVars: { 'controls': 1, 'mute': 1 }
            });
        }

        // ランダムな位置にジャンプする関数
        function jumpToRandom(player) {
            // 動画の総時間を取得
            var duration = player.getDuration();
            
            // ライブ配信の場合は seekTo が効かない場合があるためチェック
            if (duration === 0) { 
                console.log("ライブ配信または準備中のためスキップ");
                return; 
            }

            // 最後まで行くと止まるので、総時間の90%くらいの範囲でランダムにする
            var randomTime = Math.floor(Math.random() * (duration * 0.9));
            
            console.log("Jumping to: " + randomTime + "s");
            player.seekTo(randomTime, true);
        }

        // リミックス開始
        function startRemix() {
            // 入力されたIDをロード
            var v1 = document.getElementById('vid1').value;
            var v2 = document.getElementById('vid2').value;
            var intervalSec = document.getElementById('interval').value;

            player1.loadVideoById(v1);
            player2.loadVideoById(v2);

            // 音声をオンにする（ブラウザによってはユーザー操作が必要なためここで解除）
            player1.unMute();
            player2.unMute();
            
            document.getElementById('status-text').innerText = "再生中... " + intervalSec + "秒ごとにジャンプします";

            // 最初のランダムジャンプ
            jumpToRandom(player1);
            jumpToRandom(player2);

            // タイマーをセット（指定秒数ごとにジャンプ）
            if (remixTimer) clearInterval(remixTimer);
            remixTimer = setInterval(function() {
                jumpToRandom(player1);
                jumpToRandom(player2);
            }, intervalSec * 1000);
        }

        // 停止
        function stopRemix() {
            if (remixTimer) clearInterval(remixTimer);
            player1.pauseVideo();
            player2.pauseVideo();
            document.getElementById('status-text').innerText = "停止しました";
        }
    </script>
</body>
</html>